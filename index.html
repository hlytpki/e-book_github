<!DOCTYPE html>
<html>
<head>
  <title>Page Title</title>
  <style>
    body {
      background: #ccc;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    html,
    body {
      height: 100%;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      margin: 0;
      padding: 0;
    }

    #flipbook-container {
      width: 100%;
      height: calc(100% - 1rem);
      position: absolute;
      top: 0;
      left: 0;
      overflow: hidden;
      cursor: grab;
      z-index: 1;
    }

    #flipbook {
      width: 100%;
      height: 100%;
      position: absolute;
      z-index: 0;
    }

    #flipbook .page {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #flipbook img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .controls {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 0.5rem;
      background-color: black;
    }

    .controls button {
      margin-right: 0.5rem;
    }

    #extra-block {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 1rem;
      background-color: black;
      z-index: 2;
      transition: bottom 0.3s ease;
    }
  </style>
</head>
<body>

<div id="flipbook-container">
  <div id="flipbook">
    <!-- JavaScript will dynamically generate div elements here -->
  </div>
</div>

<!-- New block -->
<div id="extra-block">
  <!-- Move the buttons here -->
  <div class="controls">
    Page:
    <input type="number" id="pageFld" min=1/>
    <button id="prevPage">Previous Page</button>
    <button id="nextPage">Next Page</button>
    <button id="zoomIn">Zoom In</button>
    <button id="zoomOut">Zoom Out</button>
  </div>
</div>

<script src='javascript/jquery-3.7.1.min.js'></script>
<script src='javascript/turnjs4/lib/turn.min.js'></script>
<script src='javascript/turnjs4/lib/zoom.min.js'></script>
<script type="text/javascript">

var isZoomed = false;

$(window).ready(function() {
  // Get images from GitHub API
  $.get('https://api.github.com/repos/hlytpki/ebook/contents/files/', function(data) {
    var pageCount = data.length;
    for (var i = 0; i < pageCount; i++) {
      $('#flipbook').append('<div class="page"><img src="' + data[i].download_url + '"></div>');
    }
    
    // Initialize flipbook
    $('#flipbook').turn({
      display: 'double',
      acceleration: true,
      gradients: !$.isTouch,
      elevation: 50,
      autoCenter: true,
      when: {
        turned: function(e, page) {
          /*console.log('Current view: ', $(this).turn('view'));*/
        }
      }
    });

    // Adjust flipbook size
    $(window).resize(function(){
      adjustFlipbookSize();
      togglePageView();
    }).resize();

  });

  // Previous Page Button
  $('#prevPage').click(function() {
    if (!isZoomed) {
      $('#flipbook').turn('previous');
    }
  });

  // Next Page Button
  $('#nextPage').click(function() {
    if (!isZoomed) {
      $('#flipbook').turn('next');
    }
  });

  // Zoom In Button
  $('#zoomIn').click(function() {
    $('#flipbook').turn('zoom', 2);
    isZoomed = true;
    /*$('#extra-block').css('bottom', '1rem');*/
  });

  // Zoom Out Button
  $('#zoomOut').click(function() {
    $('#flipbook').turn('zoom', 1);
    isZoomed = false;
    $('#extra-block').css('bottom', '0');
  });

  // Get current page number
  $("#pageFld").val($("#flipbook").turn("page"));

  $("#flipbook").bind("turned", function(event, page, view) {
    $("#pageFld").val(page);
  });

  $("#pageFld").change(function() {
    $("#flipbook").turn("page", $(this).val());
  });

  // Enable drag functionality
  $('#flipbook-container').on('mousedown', function(e) {
    if (isZoomed) {
      $(this).css('cursor', 'grabbing');
      var startX = e.clientX;
      var startY = e.clientY;
      var scrollLeft = $(this).scrollLeft();
      var scrollTop = $(this).scrollTop();
      
      $(this).on('mousemove', function(event) {
        var dx = event.clientX - startX;
        var dy = event.clientY - startY;
        $(this).scrollLeft(scrollLeft - dx);
        $(this).scrollTop(scrollTop - dy);
      });
    }
  });

  // Disable drag functionality
  $(document).on('mouseup', function() {
    $('#flipbook-container').css('cursor', 'grab');
    $('#flipbook-container').off('mousemove');
  });

});

function adjustFlipbookSize() {
  var flipbook = $('#flipbook');
  flipbook.turn("size", window.innerWidth*0.67, window.innerHeight*0.93);
  flipbook.find('.page').css('background-size', 'contain');
}

function togglePageView() {
  var windowWidth = $(window).width();
  var windowHeight = $(window).height();
  var isSinglePageView = windowWidth < 560 || windowHeight < 560; // 7吋手机大约是560px x 1000px
  if (isSinglePageView) {
    $('#flipbook').turn('display', 'single');
  } else {
    $('#flipbook').turn('display', 'double');
  }
}

</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Page Title</title>
  <style>
    body {
      background: #ccc;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    html,
    body {
      height: 100%;
      width: 100%;
    }

    #flipbook-container {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      cursor: grab; /* Add grab cursor */
    }

    #flipbook {
      width: 100%;
      height: 100%;
      position: absolute;
    }

    #flipbook .page {
      background-color: #ccc;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div id="flipbook-container">
  <div id="flipbook">
    <!-- JavaScript 會動態生成下面的 div 元素 -->
  </div>
</div>

<div class="controls">
  Page:
  <input type="number" id="pageFld" min=1/>
  <button id="prevPage">Previous Page</button>
  <button id="nextPage">Next Page</button>
  <button id="zoomIn">Zoom In</button>
  <button id="zoomOut">Zoom Out</button>
</div>

<script src='javascript/jquery-3.7.1.min.js'></script>
<script src='javascript/turnjs4/lib/turn.min.js'></script>
<script src='javascript/turnjs4/lib/zoom.min.js'></script>
<script type="text/javascript">

var isZoomed = false;

$(window).ready(function() {
  // Get images from GitHub API
  $.get('https://api.github.com/repos/hlytpki/ebook/contents/files/', function(data) {
    var pageCount = data.length;
    for (var i = 0; i < pageCount; i++) {
      $('#flipbook').append('<div class="page" style="background-image: url(' + data[i].download_url + ')"></div>');
    }
    
    // Initialize flipbook
    $('#flipbook').turn({
      display: 'double',
      acceleration: true,
      gradients: !$.isTouch,
      elevation: 50,
      autoCenter: true,
      when: {
        turned: function(e, page) {
          /*console.log('Current view: ', $(this).turn('view'));*/
        }
      }
    });

    // Adjust flipbook size
    $(window).resize(function(){
      var flipbook = $('#flipbook');
      flipbook.turn("size", window.innerWidth * 0.5, window.innerHeight * 0.8);
      flipbook.find('.page').css('background-size', 'contain');
    }).resize();

  });

  // Previous Page Button
  $('#prevPage').click(function() {
    if (!isZoomed) {
      $('#flipbook').turn('previous');
    }
  });

  // Next Page Button
  $('#nextPage').click(function() {
    if (!isZoomed) {
      $('#flipbook').turn('next');
    }
  });

  // Zoom In Button
  $('#zoomIn').click(function() {
    $('#flipbook').turn('zoom', 2);
    isZoomed = true;
  });

  // Zoom Out Button
  $('#zoomOut').click(function() {
    $('#flipbook').turn('zoom', 1);
    isZoomed = false;
  });

  // Get current page number
  $("#pageFld").val($("#flipbook").turn("page"));

  $("#flipbook").bind("turned", function(event, page, view) {
    $("#pageFld").val(page);
  });

  $("#pageFld").change(function() {
    $("#flipbook").turn("page", $(this).val());
  });

  // Enable drag functionality
  $('#flipbook-container').on('mousedown', function(e) {
    if (isZoomed) {
      $(this).css('cursor', 'grabbing'); // Change cursor style
      var startX = e.clientX;
      var startY = e.clientY;
      var scrollLeft = $(this).scrollLeft();
      var scrollTop = $(this).scrollTop();
      
      $(this).on('mousemove', function(event) {
        var dx = event.clientX - startX;
        var dy = event.clientY - startY;
        $(this).scrollLeft(scrollLeft - dx);
        $(this).scrollTop(scrollTop - dy);
      });
    }
  });

  // Disable drag functionality
  $(document).on('mouseup', function() {
    $('#flipbook-container').css('cursor', 'grab');
    $('#flipbook-container').off('mousemove');
  });

});

</script>
</body>
</html>
